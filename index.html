<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoMarket - Buy & Sell Cars</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header Styles */
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
        }

        .logo i {
            color: var(--secondary);
            margin-right: 10px;
        }

        .logo span {
            color: var(--accent);
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 1.5rem;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            padding: 0.5rem 0;
        }

        nav ul li a:hover {
            color: var(--secondary);
        }

        .auth-buttons button {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
            margin-left: 10px;
        }

        .auth-buttons button:hover {
            background: #2980b9;
        }

        .user-menu {
            display: flex;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-right: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: white;
            font-weight: bold;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(44, 62, 80, 0.8), rgba(44, 62, 80, 0.9)), url('https://images.unsplash.com/photo-1486496572940-2bb2341fdbdf?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 5rem 0;
            text-align: center;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 2rem;
        }

        .search-bar {
            display: flex;
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 50px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .search-bar input {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            outline: none;
            font-size: 1rem;
        }

        .search-bar button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0 2rem;
            cursor: pointer;
            transition: background 0.3s;
        }

        .search-bar button:hover {
            background: #c0392b;
        }

        /* Main Content */
        .main-content {
            padding: 3rem 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--dark);
        }

        .section-title h2 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
        }

        .section-title p {
            color: #7f8c8d;
        }

        /* Car Listings */
        .car-listings {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .car-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .car-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .car-image {
            height: 200px;
            width: 100%;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 3rem;
            position: relative;
            overflow: hidden;
        }

        .car-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .car-details {
            padding: 1.5rem;
        }

        .car-title {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .car-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 1rem;
        }

        .car-specs {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            color: #7f8c8d;
        }

        .car-specs span {
            display: flex;
            align-items: center;
        }

        .car-specs i {
            margin-right: 5px;
        }

        .car-actions {
            display: flex;
            justify-content: space-between;
        }

        .btn {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #dde4e6;
        }

        .btn-accent {
            background: var(--accent);
            color: white;
        }

        .btn-accent:hover {
            background: #c0392b;
        }

        /* Forms */
        .form-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            max-width: 600px;
            margin: 2rem auto;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-control:focus {
            border-color: var(--secondary);
            outline: none;
        }

        .form-row {
            display: flex;
            gap: 1rem;
        }

        .form-row .form-group {
            flex: 1;
        }

        .photo-upload {
            border: 2px dashed #ddd;
            border-radius: 4px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: border 0.3s;
        }

        .photo-upload:hover {
            border-color: var(--secondary);
        }

        .photo-upload i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 1rem;
        }

        /* Auth Pages */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
            padding: 2rem 0;
        }

        .auth-form {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            width: 100%;
            max-width: 450px;
        }

        .auth-form h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--dark);
        }

        .auth-form p {
            text-align: center;
            margin-bottom: 2rem;
            color: #7f8c8d;
        }

        .auth-switch {
            text-align: center;
            margin-top: 1.5rem;
            color: #7f8c8d;
        }

        .auth-switch a {
            color: var(--secondary);
            text-decoration: none;
            font-weight: 500;
        }

        .auth-switch a:hover {
            text-decoration: underline;
        }

        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 3rem 0 1rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 0.8rem;
        }

        .footer-section ul li a {
            color: #bdc3c7;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-section ul li a:hover {
            color: white;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid #34495e;
            color: #bdc3c7;
            font-size: 0.9rem;
        }

        /* Page Transitions */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
            }

            nav ul {
                margin: 1rem 0;
            }

            .hero h1 {
                font-size: 2.2rem;
            }

            .search-bar {
                flex-direction: column;
                border-radius: 10px;
            }

            .search-bar input {
                border-radius: 10px 10px 0 0;
            }

            .search-bar button {
                border-radius: 0 0 10px 10px;
                padding: 1rem;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-car"></i>
                    Auto<span>Market</span>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link" data-page="home">Home</a></li>
                        <li><a href="#" class="nav-link" data-page="browse">Browse Cars</a></li>
                        <li><a href="#" class="nav-link" data-page="sell">Sell Your Car</a></li>
                        <li><a href="#" class="nav-link" data-page="about">About</a></li>
                        <li><a href="#" class="nav-link" data-page="contact">Contact</a></li>
                    </ul>
                </nav>
                <div class="auth-buttons">
                    <div class="user-menu" id="userMenu">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Home Page -->
    <div id="home-page" class="page active">
        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <h1>Find Your Perfect Car</h1>
                <p>Browse thousands of new and used cars for sale from trusted sellers nationwide.</p>
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Search by make, model, or keyword...">
                    <button id="searchButton"><i class="fas fa-search"></i> Search</button>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <div class="container main-content">
            <!-- Featured Listings -->
            <div class="section-title">
                <h2>Featured Listings</h2>
                <p>Check out these premium vehicles</p>
            </div>

            <div class="car-listings" id="carListings">
                <!-- Car listings will be populated by JavaScript -->
            </div>

            <!-- My Listings Section (only for logged in users) -->
            <div id="my-listings-section" style="display: none;">
                <div class="section-title">
                    <h2>My Listings</h2>
                    <p>Manage your car listings</p>
                </div>

                <div class="car-listings" id="myCarListings">
                    <!-- My car listings will be populated by JavaScript -->
                </div>
            </div>

            <!-- Add New Car Section (only for logged in users) -->
            <div id="add-car-section" style="display: none;">
                <div class="section-title">
                    <h2>List Your Car</h2>
                    <p>Reach thousands of potential buyers</p>
                </div>

                <div class="form-container">
                    <form id="carForm">
                        <div class="form-group">
                            <label for="carTitle">Car Title</label>
                            <input type="text" id="carTitle" class="form-control" placeholder="e.g., 2020 Toyota Camry XLE" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="carMake">Make</label>
                                <input type="text" id="carMake" class="form-control" placeholder="Toyota" required>
                            </div>
                            <div class="form-group">
                                <label for="carModel">Model</label>
                                <input type="text" id="carModel" class="form-control" placeholder="Camry" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="carYear">Year</label>
                                <input type="number" id="carYear" class="form-control" placeholder="2020" min="1990" max="2023" required>
                            </div>
                            <div class="form-group">
                                <label for="carPrice">Price ($)</label>
                                <input type="number" id="carPrice" class="form-control" placeholder="25000" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="carMileage">Mileage</label>
                                <input type="number" id="carMileage" class="form-control" placeholder="45000" required>
                            </div>
                            <div class="form-group">
                                <label for="carFuel">Fuel Type</label>
                                <select id="carFuel" class="form-control" required>
                                    <option value="">Select Fuel Type</option>
                                    <option value="Gasoline">Gasoline</option>
                                    <option value="Diesel">Diesel</option>
                                    <option value="Electric">Electric</option>
                                    <option value="Hybrid">Hybrid</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="carDescription">Description</label>
                            <textarea id="carDescription" class="form-control" rows="4" placeholder="Describe your car..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Car Photos</label>
                            <div class="photo-upload" id="photoUpload">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Click to upload photos or drag and drop</p>
                                <input type="file" id="carPhotos" multiple accept="image/*" style="display: none;">
                            </div>
                            <div id="photoPreview" style="margin-top: 1rem;"></div>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">List Your Car</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="page">
        <div class="auth-container">
            <div class="auth-form">
                <h2>Login to Your Account</h2>
                <p>Access your car listings and manage your profile</p>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email Address</label>
                        <input type="email" id="loginEmail" class="form-control" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password" required>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                    </div>
                </form>
                <div class="auth-switch">
                    Don't have an account? <a href="#" id="goToRegister">Register here</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Page -->
    <div id="register-page" class="page">
        <div class="auth-container">
            <div class="auth-form">
                <h2>Create an Account</h2>
                <p>Join our community to start buying and selling cars</p>
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerName">Full Name</label>
                        <input type="text" id="registerName" class="form-control" placeholder="John Doe" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email Address</label>
                        <input type="email" id="registerEmail" class="form-control" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" class="form-control" placeholder="Create a password" required>
                    </div>
                    <div class="form-group">
                        <label for="registerConfirmPassword">Confirm Password</label>
                        <input type="password" id="registerConfirmPassword" class="form-control" placeholder="Confirm your password" required>
                    </div>
                    <div class="form-group">
                        <label for="registerUserType">I want to:</label>
                        <select id="registerUserType" class="form-control" required>
                            <option value="">Select Option</option>
                            <option value="buyer">Buy Cars</option>
                            <option value="seller">Sell Cars</option>
                            <option value="both">Buy and Sell Cars</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Create Account</button>
                    </div>
                </form>
                <div class="auth-switch">
                    Already have an account? <a href="#" id="goToLogin">Login here</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>AutoMarket</h3>
                    <p>Your trusted platform for buying and selling vehicles. Find the perfect car or connect with buyers for your vehicle.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#" class="nav-link" data-page="home">Home</a></li>
                        <li><a href="#" class="nav-link" data-page="browse">Browse Cars</a></li>
                        <li><a href="#" class="nav-link" data-page="sell">Sell Your Car</a></li>
                        <li><a href="#" class="nav-link" data-page="about">About Us</a></li>
                        <li><a href="#" class="nav-link" data-page="contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> 123 Auto Street, Car City</li>
                        <li><i class="fas fa-phone"></i> (123) 456-7890</li>
                        <li><i class="fas fa-envelope"></i> info@automarket.com</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 AutoMarket. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Sample data for demonstration
        const sampleCars = [
            {
                id: 1,
                title: "2021 Honda Civic LX",
                make: "Honda",
                model: "Civic",
                year: 2021,
                price: 22500,
                mileage: 15000,
                fuel: "Gasoline",
                description: "Well-maintained Honda Civic with low mileage. Single owner, no accidents.",
                image: "https://images.unsplash.com/photo-1552519507-da3b142c6e3d?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60",
                userId: 0 // Sample user ID
            },
            {
                id: 2,
                title: "2020 Ford Mustang GT",
                make: "Ford",
                model: "Mustang",
                year: 2020,
                price: 38500,
                mileage: 22000,
                fuel: "Gasoline",
                description: "Powerful V8 engine, premium sound system, excellent condition.",
                image: "https://images.unsplash.com/photo-1544636331-e26879cd4d9b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60",
                userId: 0
            },
            {
                id: 3,
                title: "2019 Toyota RAV4 Hybrid",
                make: "Toyota",
                model: "RAV4",
                year: 2019,
                price: 28900,
                mileage: 32000,
                fuel: "Hybrid",
                description: "Fuel-efficient hybrid SUV with plenty of cargo space. All maintenance records available.",
                image: "https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60",
                userId: 0
            }
        ];

        // User management
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let allCars = JSON.parse(localStorage.getItem('allCars')) || sampleCars;

        // DOM Elements
        const userMenu = document.getElementById('userMenu');
        const carListings = document.getElementById('carListings');
        const myCarListings = document.getElementById('myCarListings');
        const myListingsSection = document.getElementById('my-listings-section');
        const addCarSection = document.getElementById('add-car-section');
        const carForm = document.getElementById('carForm');
        const photoUpload = document.getElementById('photoUpload');
        const carPhotos = document.getElementById('carPhotos');
        const photoPreview = document.getElementById('photoPreview');
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.nav-link');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const goToRegister = document.getElementById('goToRegister');
        const goToLogin = document.getElementById('goToLogin');
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');

        // Initialize the app
        function init() {
            renderUserMenu();
            renderCarListings();
            setupEventListeners();
            
            // Show appropriate page based on user status
            if (currentUser) {
                showPage('home');
                showUserSections();
            } else {
                showPage('home');
            }
        }

        // Show specific page
        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
                if (page.id === `${pageId}-page`) {
                    page.classList.add('active');
                }
            });
        }

        // Show user-specific sections if logged in
        function showUserSections() {
            if (currentUser) {
                myListingsSection.style.display = 'block';
                addCarSection.style.display = 'block';
                renderMyCarListings();
            } else {
                myListingsSection.style.display = 'none';
                addCarSection.style.display = 'none';
            }
        }

        // Render user menu based on login status
        function renderUserMenu() {
            if (currentUser) {
                userMenu.innerHTML = `
                    <div class="user-info">
                        <div class="user-avatar">${currentUser.name.charAt(0)}</div>
                        <span>${currentUser.name}</span>
                    </div>
                    <button onclick="logout()">Logout</button>
                `;
            } else {
                userMenu.innerHTML = `
                    <button onclick="showPage('login')">Login</button>
                    <button onclick="showPage('register')">Register</button>
                `;
            }
        }

        // Render car listings
        function renderCarListings() {
            carListings.innerHTML = '';
            
            if (allCars.length === 0) {
                carListings.innerHTML = '<p style="text-align: center; width: 100%;">No cars listed yet. Be the first to add a car!</p>';
                return;
            }
            
            allCars.forEach(car => {
                const carCard = createCarCard(car, false);
                carListings.appendChild(carCard);
            });
        }

        // Render user's car listings
        function renderMyCarListings() {
            myCarListings.innerHTML = '';
            
            if (currentUser) {
                const userCars = allCars.filter(car => car.userId === currentUser.id);
                
                if (userCars.length === 0) {
                    myCarListings.innerHTML = '<p style="text-align: center; width: 100%;">You haven\'t listed any cars yet.</p>';
                } else {
                    userCars.forEach(car => {
                        const carCard = createCarCard(car, true);
                        myCarListings.appendChild(carCard);
                    });
                }
            }
        }

        // Create a car card element
        function createCarCard(car, isMyListing) {
            const carCard = document.createElement('div');
            carCard.className = 'car-card';
            carCard.innerHTML = `
                <div class="car-image">
                    ${car.image ? `<img src="${car.image}" alt="${car.title}">` : '<i class="fas fa-car"></i>'}
                </div>
                <div class="car-details">
                    <h3 class="car-title">${car.title}</h3>
                    <div class="car-price">$${car.price.toLocaleString()}</div>
                    <div class="car-specs">
                        <span><i class="fas fa-calendar-alt"></i> ${car.year}</span>
                        <span><i class="fas fa-tachometer-alt"></i> ${car.mileage.toLocaleString()} mi</span>
                        <span><i class="fas fa-gas-pump"></i> ${car.fuel}</span>
                    </div>
                    <p>${car.description}</p>
                    <div class="car-actions">
                        ${isMyListing ? 
                            `<button class="btn btn-secondary" onclick="editCar(${car.id})"><i class="fas fa-edit"></i> Edit</button>
                             <button class="btn btn-accent" onclick="deleteCar(${car.id})"><i class="fas fa-trash"></i> Delete</button>` :
                            `<button class="btn btn-secondary"><i class="fas fa-info-circle"></i> Details</button>
                             <button class="btn btn-primary"><i class="fas fa-envelope"></i> Contact</button>`
                        }
                    </div>
                </div>
            `;
            return carCard;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    
                    if ((page === 'sell' || page === 'browse') && !currentUser) {
                        showPage('login');
                        return;
                    }
                    
                    showPage(page);
                });
            });

            // Photo upload
            photoUpload.addEventListener('click', () => {
                carPhotos.click();
            });

            carPhotos.addEventListener('change', handlePhotoUpload);

            // Form submission
            carForm.addEventListener('submit', handleFormSubmit);
            
            // Auth forms
            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);
            
            // Auth page switching
            goToRegister.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('register');
            });
            
            goToLogin.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('login');
            });
            
            // Search functionality
            searchButton.addEventListener('click', handleSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleSearch();
                }
            });
        }

        // Handle photo upload
        function handlePhotoUpload(e) {
            const files = e.target.files;
            photoPreview.innerHTML = '';
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.width = '100px';
                    img.style.height = '80px';
                    img.style.objectFit = 'cover';
                    img.style.marginRight = '10px';
                    img.style.borderRadius = '4px';
                    photoPreview.appendChild(img);
                }
                
                reader.readAsDataURL(file);
            }
        }

        // Handle form submission
        function handleFormSubmit(e) {
            e.preventDefault();
            
            if (!currentUser) {
                alert('Please log in to list a car.');
                showPage('login');
                return;
            }
            
            const newCar = {
                id: Date.now(), // Simple ID generation
                userId: currentUser.id,
                title: document.getElementById('carTitle').value,
                make: document.getElementById('carMake').value,
                model: document.getElementById('carModel').value,
                year: parseInt(document.getElementById('carYear').value),
                price: parseInt(document.getElementById('carPrice').value),
                mileage: parseInt(document.getElementById('carMileage').value),
                fuel: document.getElementById('carFuel').value,
                description: document.getElementById('carDescription').value,
                image: carPhotos.files.length > 0 ? URL.createObjectURL(carPhotos.files[0]) : null
            };
            
            allCars.push(newCar);
            localStorage.setItem('allCars', JSON.stringify(allCars));
            
            alert('Car listed successfully!');
            carForm.reset();
            photoPreview.innerHTML = '';
            renderCarListings();
            renderMyCarListings();
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Simple validation (in a real app, this would be more secure)
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                renderUserMenu();
                showUserSections();
                showPage('home');
                alert(`Welcome back, ${user.name}!`);
            } else {
                alert('Invalid email or password. Please try again.');
            }
        }

        // Handle registration
        function handleRegister(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const userType = document.getElementById('registerUserType').value;
            
            // Validation
            if (password !== confirmPassword) {
                alert('Passwords do not match. Please try again.');
                return;
            }
            
            if (users.find(u => u.email === email)) {
                alert('An account with this email already exists. Please log in instead.');
                return;
            }
            
            const newUser = {
                id: Date.now(),
                name,
                email,
                password,
                userType,
                joined: new Date().toLocaleDateString()
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            renderUserMenu();
            showUserSections();
            showPage('home');
            alert(`Welcome to AutoMarket, ${name}!`);
        }

        // Handle search
        function handleSearch() {
            const query = searchInput.value.toLowerCase().trim();
            
            if (query === '') {
                renderCarListings();
                return;
            }
            
            const filteredCars = allCars.filter(car => 
                car.title.toLowerCase().includes(query) ||
                car.make.toLowerCase().includes(query) ||
                car.model.toLowerCase().includes(query) ||
                car.description.toLowerCase().includes(query)
            );
            
            carListings.innerHTML = '';
            
            if (filteredCars.length === 0) {
                carListings.innerHTML = '<p style="text-align: center; width: 100%;">No cars found matching your search.</p>';
            } else {
                filteredCars.forEach(car => {
                    const carCard = createCarCard(car, false);
                    carListings.appendChild(carCard);
                });
            }
        }

        // Edit car function
        function editCar(carId) {
            const car = allCars.find(c => c.id === carId);
            if (car) {
                // Populate form with car data
                document.getElementById('carTitle').value = car.title;
                document.getElementById('carMake').value = car.make;
                document.getElementById('carModel').value = car.model;
                document.getElementById('carYear').value = car.year;
                document.getElementById('carPrice').value = car.price;
                document.getElementById('carMileage').value = car.mileage;
                document.getElementById('carFuel').value = car.fuel;
                document.getElementById('carDescription').value = car.description;
                
                // Scroll to form
                addCarSection.scrollIntoView({ behavior: 'smooth' });
                
                // Change form button text
                document.querySelector('#carForm button').textContent = 'Update Car Listing';
                
                // Remove the car from listings (will be re-added on submit)
                allCars = allCars.filter(c => c.id !== carId);
                localStorage.setItem('allCars', JSON.stringify(allCars));
                renderCarListings();
                renderMyCarListings();
            }
        }

        // Delete car function
        function deleteCar(carId) {
            if (confirm('Are you sure you want to delete this car listing?')) {
                allCars = allCars.filter(c => c.id !== carId);
                localStorage.setItem('allCars', JSON.stringify(allCars));
                renderCarListings();
                renderMyCarListings();
            }
        }

        // Logout function
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            renderUserMenu();
            showUserSections();
            showPage('home');
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>